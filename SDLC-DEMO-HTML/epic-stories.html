<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic, Features & Stories - SDLC Portal</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script> window.FontAwesomeConfig = { autoReplaceSvg: 'nest'};</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'ignis-primary': '#3B82F6',
                        'ignis-secondary': '#8B5CF6',
                        'ignis-accent': '#EC4899',
                        'ignis-gradient-start': '#3B82F6',
                        'ignis-gradient-end': '#EC4899',
                        'ignis-dark': '#1E293B',
                        'ignis-light': '#F8FAFC',
                        'ignis-gray': '#64748B',
                        'ignis-success': '#10B981',
                        'ignis-warning': '#F59E0B',
                        'ignis-danger': '#EF4444',
                        'brand-primary': '#3B82F6',
                        'brand-secondary': '#F1F5F9',
                        'brand-dark': '#1E293B',
                        'brand-light': '#F8FAFC',
                        'brand-accent': '#EC4899',
                        'brand-warning': '#F59E0B',
                        'brand-danger': '#EF4444',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="shared-sidebar.css">
    <style>
        /* Completed Phase Styling - Light green background */
        .phase-section.completed .phase-toggle,
        .config-link.completed {
            background: rgba(34, 197, 94, 0.05);
        }
        
        .phase-section.completed .phase-toggle:hover,
        .config-link.completed:hover {
            background: rgba(34, 197, 94, 0.1);
        }
        
        .phase-section.completed .phase-toggle span,
        .config-link.completed span {
            color: #16a34a;
            font-weight: 500;
        }
        
        /* Active Phase Styling */
        .phase-section.active .phase-toggle {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3B82F6;
            padding-left: 9px;
        }
        
        .phase-section.active .phase-toggle:hover {
            background: rgba(59, 130, 246, 0.15);
        }
        
        .phase-section.active .phase-toggle span {
            color: #1f2937;
            font-weight: 500;
        }
        
        .phase-section.active .fas.fa-tasks {
            color: #3B82F6 !important;
        }
        
        .phase-section.completed .fas.fa-lightbulb,
        .phase-section.completed .fas.fa-file-alt,
        .config-link.completed .fas.fa-cog {
            display: none !important;
        }
        
        .phase-section.completed .phase-check-icon,
        .config-link.completed .phase-check-icon {
            display: inline-block !important;
            color: #16a34a !important;
        }
        
        .phase-check-icon {
            display: none;
        }
        
        .phase-complete-icon {
            display: none !important;
        }
        
        .submenu-complete-icon {
            display: none !important;
        }
        
        .phase-section.active .phase-active-dot {
            display: inline-block !important;
        }
        
        .phase-active-dot {
            display: none;
        }
        
        .submenu-item.completed {
            background: transparent;
        }
        
        .submenu-item.completed:hover {
            background: rgba(34, 197, 94, 0.08);
        }
        
        .submenu-item.completed span {
            color: #16a34a;
            font-weight: 500;
        }
        
        .submenu-item.active span {
            color: #3B82F6;
            font-weight: 500;
        }
        
        .submenu-item.active .submenu-active-dot {
            display: inline-block !important;
        }
        
        .submenu-active-dot {
            display: none;
        }

        /* Epic Card Styles */
        .epic-card {
            border-left: 4px solid #8B5CF6;
        }

        .feature-card {
            border-left: 4px solid #3B82F6;
        }

        .story-card {
            border-left: 4px solid #10B981;
        }

        /* Typing Animation */
        .typing-indicator {
            display: inline-block;
        }

        .typing-indicator span {
            animation: blink 1.4s infinite;
            animation-fill-mode: both;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes blink {
            0%, 80%, 100% {
                opacity: 0;
            }
            40% {
                opacity: 1;
            }
        }
    </style>
</head>
<body class="font-inter bg-brand-light">

    <div id="project-layout" class="flex w-full h-screen min-h-screen overflow-hidden">
        <!-- Mobile Menu Button -->
        <button id="mobile-menu-button" class="fixed top-4 left-4 z-50 lg:hidden bg-white p-2 rounded-lg shadow-lg border border-gray-200 transition-all duration-200 hover:shadow-xl">
            <i class="fas fa-bars text-ignis-primary"></i>
        </button>
        
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="sidebar-component fixed lg:relative bg-white border-r border-gray-200 flex flex-col z-40 lg:z-auto h-screen lg:h-screen transform -translate-x-full lg:translate-x-0 transition-transform duration-300 overflow-y-auto" style="width: 250px;" data-expanded="true">
            <!-- Sidebar Header -->
            <div class="p-4 py-2 flex items-center justify-between border-b border-gray-200">
                <div class="flex items-center space-x-3">
                    <div>
                        <img src="ignis-logo.svg" alt="Ignis Logo" style="height: 30px;">
                        <p class="text-md text-ignis-gray mt-1 font-semibold">SDLC Portal</p>
                    </div>
                </div>
            </div>

            <!-- Main Navigation -->
            <nav class="flex-1 px-4 py-4 space-y-1 overflow-y-auto min-h-0">
                <!-- Project Selector -->
                <div class="mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <label class="text-xs font-semibold text-gray-600 tracking-wider">Project</label>
                        <button class="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-brand-primary hover:bg-brand-primary/10 transition-all duration-200 rounded-md" title="Add New Project">
                            <i class="fas fa-plus text-xs"></i>
                        </button>
                    </div>
                    <div class="relative">
                        <button class="w-full px-3 py-3 text-left border-0 rounded-xl bg-gray-50 hover:bg-gray-100 focus:bg-white focus:ring-2 focus:ring-brand-primary/20 focus:shadow-sm outline-none transition-all duration-200 cursor-pointer" onclick="toggleProjectDropdown()">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-xs font-medium text-brand-dark">E-commerce Platform Revamp</div>
                                    <div class="text-xs text-gray-500 mt-0.5">Complete redesign of existing platform</div>
                                </div>
                                <i class="fas fa-chevron-down text-xs text-gray-400" id="dropdown-arrow"></i>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="mb-6 pb-6 border-b border-gray-200">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-medium text-gray-600">Overall Progress</span>
                        <span id="progress-percentage" class="text-xs font-semibold text-green-600">45%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progress-bar" class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: 45%"></div>
                    </div>
                </div>

                <!-- Phase Menu -->
                <div class="space-y-1">
                    <p class="text-xs font-medium text-gray-600 tracking-wide mb-3">Project Phases</p>
                    
                    <!-- Config Phase - COMPLETED -->
                    <a href="project-config.html" class="config-link completed text-xs flex items-center justify-between px-3 py-2 text-xs font-medium text-gray-700 hover:text-brand-primary hover:bg-gray-50 rounded-lg transition-colors">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle phase-check-icon w-4 h-4 mr-3"></i>
                            <span>Config</span>
                        </div>
                    </a>

                    <!-- Ideation Phase - COMPLETED -->
                    <div class="phase-section completed" data-phase="ideation">
                        <button class="text-xs phase-toggle w-full flex items-center justify-between px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle phase-check-icon w-4 h-4 mr-3"></i>
                                <span>Ideation</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-chevron-down text-xs text-gray-400 transition-transform"></i>
                            </div>
                        </button>
                        <div class="phase-submenu ml-7 mt-0 space-y-0 hidden">
                            <a href="project-ideation.html" class="submenu-item completed flex items-center justify-between px-3 py-2 text-xs text-gray-600 hover:text-brand-primary hover:bg-gray-50 rounded-lg transition-colors">
                                <span>Brainstorming</span>
                            </a>
                            <a href="market-research.html" class="submenu-item completed flex items-center justify-between px-3 py-2 text-xs text-gray-600 hover:text-brand-primary hover:bg-gray-50 rounded-lg transition-colors">
                                <span>Market Research</span>
                            </a>
                            <a href="competitor-analysis.html" class="submenu-item completed flex items-center justify-between px-3 py-2 text-xs text-gray-600 hover:text-brand-primary hover:bg-gray-50 rounded-lg transition-colors">
                                <span>Competitor Analysis</span>
                            </a>
                        </div>
                    </div>

                    <!-- Product Definition Phase - COMPLETED -->
                    <div class="phase-section completed" data-phase="product-definition">
                        <button class="text-xs phase-toggle w-full flex items-center justify-between px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle phase-check-icon w-4 h-4 mr-3"></i>
                                <span>Product Definition</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-chevron-down text-xs text-gray-400 transition-transform"></i>
                            </div>
                        </button>
                        <div class="phase-submenu ml-7 mt-0 space-y-0 hidden">
                            <a href="requirements.html" class="submenu-item completed flex items-center justify-between px-3 py-2 text-xs text-gray-600 hover:text-brand-primary hover:bg-gray-50 rounded-lg transition-colors">
                                <span>PRD</span>
                            </a>
                            <a href="technical-architect.html" class="submenu-item completed flex items-center justify-between px-3 py-2 text-xs text-gray-600 hover:text-brand-primary hover:bg-gray-50 rounded-lg transition-colors">
                                <span>Architecture</span>
                            </a>
                        </div>
                    </div>

                    <!-- Planning Phase - ACTIVE -->
                    <div class="phase-section active" data-phase="planning">
                        <button class="text-xs phase-toggle w-full flex items-center justify-between px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
                            <div class="flex items-center">
                                <i class="fas fa-tasks w-4 h-4 mr-3 text-blue-500"></i>
                                <span>Planning</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-circle text-blue-500 text-xs animate-pulse phase-active-dot"></i>
                                <i class="fas fa-chevron-down text-xs text-gray-400 transition-transform"></i>
                            </div>
                        </button>
                        <div class="phase-submenu ml-7 mt-0 space-y-0">
                            <a href="epic-stories.html" class="submenu-item active flex items-center justify-between px-3 py-2 text-xs text-gray-600 hover:text-brand-primary hover:bg-gray-50 rounded-lg transition-colors">
                                <span>Epic, Feature & Stories</span>
                                <i class="fas fa-circle text-blue-500 text-xs animate-pulse submenu-active-dot"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Implementation Phase -->
                    <div class="phase-section" data-phase="implementation">
                        <button class="text-xs phase-toggle w-full flex items-center justify-between px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
                            <div class="flex items-center">
                                <i class="fas fa-code w-4 h-4 mr-3 text-gray-400"></i>
                                <span>Implementation</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-chevron-down text-xs text-gray-400 transition-transform"></i>
                            </div>
                        </button>
                        <div class="phase-submenu ml-7 mt-0 space-y-0 hidden">
                            <a href="#" class="submenu-item flex items-center justify-between px-3 py-2 text-xs text-gray-600 hover:text-brand-primary hover:bg-gray-50 rounded-lg transition-colors">
                                <span>Design</span>
                            </a>
                            <a href="#" class="submenu-item flex items-center justify-between px-3 py-2 text-xs text-gray-600 hover:text-brand-primary hover:bg-gray-50 rounded-lg transition-colors">
                                <span>Dev & Testing</span>
                            </a>
                        </div>
                    </div>

                    <!-- Deployment Phase -->
                    <div class="phase-section" data-phase="deployment">
                        <button class="text-xs phase-toggle w-full flex items-center justify-between px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
                            <div class="flex items-center">
                                <i class="fas fa-rocket w-4 h-4 mr-3 text-gray-400"></i>
                                <span>Deployment</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-chevron-down text-xs text-gray-400 transition-transform"></i>
                            </div>
                        </button>
                        <div class="phase-submenu ml-7 mt-0 space-y-0 hidden">
                            <a href="#" class="submenu-item flex items-center justify-between px-3 py-2 text-xs text-gray-600 hover:text-brand-primary hover:bg-gray-50 rounded-lg transition-colors">
                                <span>Release</span>
                            </a>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Bottom Section -->
            <div class="px-4 py-4 border-t border-gray-100 mt-auto">
                <a href="dashboard.html" class="text-xs nav-item flex items-center text-xs font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-colors mb-1">
                    <i class="fas fa-arrow-left w-4 h-4 mr-3 text-gray-400"></i>
                    <span class="sidebar-text">Back to Projects</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="flex-1 bg-brand-light h-screen lg:ml-0 flex flex-col overflow-hidden">
            <!-- Header -->
            <header id="header" class="bg-white border-b border-gray-200 z-10 flex-shrink-0">
                <div class="px-4 sm:px-4 lg:px-4 py-4 flex justify-between items-center">
                    <div class="flex items-center space-x-4">                       
                        <div>
                            <h1 class="text-lg font-semibold text-brand-dark">Epic, Features & Stories</h1>
                            <p class="text-xs text-gray-500">Generate your project's epics, features, and user stories</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 sm:space-x-4 lg:space-x-6">
                        <button class="relative text-gray-500 hover:text-brand-primary p-2 transition-colors">
                            <i class="far fa-bell text-lg"></i>
                            <span class="absolute top-1.5 right-1.5 h-1.5 w-1.5 bg-brand-danger rounded-full"></span>
                        </button>
                        <div class="relative flex items-center space-x-2 sm:space-x-3">
                            <img src="https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-5.jpg" alt="User Avatar" class="w-8 h-8 sm:w-10 sm:h-10 rounded-full object-cover">
                            <div class="hidden sm:block">
                                <p class="font-semibold text-xs text-brand-dark">Alicia Keys</p>
                                <p class="text-xs text-gray-500">Product Manager</p>
                            </div>
                            <button onclick="toggleUserDropdown()" class="text-gray-400 hover:text-brand-dark hidden sm:block">
                                <i class="fas fa-chevron-down text-xs" id="user-dropdown-arrow"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- AI Assistant Chat Interface -->
            <div class="flex-1 flex bg-white overflow-hidden min-h-0">
                <!-- Chat Section -->
                <div id="chat-section" class="flex flex-col min-h-0" style="flex: 1 1 auto;">
                    <!-- Chat Messages -->
                    <div class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50" id="chat-messages">
                        <!-- Initial AI Message -->
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 bg-gradient-to-r from-ignis-primary to-ignis-accent rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="fa-solid fa-robot text-white text-xs"></i>
                            </div>
                            <div class="bg-white rounded-lg rounded-tl-none p-3 max-w-2xl shadow-sm">
                                <p class="text-gray-900 text-xs">Hi! I'm ready to help you create Epics, Features, and User Stories for your E-commerce Platform Revamp project. Based on your PRD and technical architecture, I can generate a comprehensive breakdown. Would you like me to start?</p>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Input - Modern Minimal Design -->
                    <div class="border-t border-gray-100 px-4 py-3 bg-white flex-shrink-0">
                        <!-- Input Container -->
                        <div class="flex items-center space-x-2 bg-gray-50 rounded-xl px-3 py-2 border border-gray-200 hover:border-gray-300 focus-within:border-ignis-primary focus-within:ring-2 focus-within:ring-ignis-primary/10 transition-all">
                            <!-- Left Action Buttons -->
                            <div class="flex items-center space-x-1">
                                <!-- Add/New Button -->
                                <div class="relative">
                                    <button type="button" id="new-chat-button" onclick="toggleNewChatPopup()" class="w-8 h-8 flex items-center justify-center text-gray-500 hover:text-ignis-primary hover:bg-white rounded-lg transition-all" title="New chat">
                                        <i class="fas fa-plus text-xs"></i>
                                    </button>
                                    
                                    <!-- New Chat Popup -->
                                    <div id="new-chat-popup" class="hidden absolute bottom-full left-0 mb-2 w-64 bg-white border border-gray-200 rounded-xl shadow-xl z-50 p-4">
                                        <h3 class="text-xs font-semibold text-gray-900 mb-3">Start New Conversation</h3>
                                        <div class="space-y-2">
                                            <button onclick="startNewChat('blank')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 rounded-lg transition-colors flex items-center space-x-2">
                                                <i class="fas fa-comment text-blue-500"></i>
                                                <span>Blank Chat</span>
                                            </button>
                                            <button onclick="startNewChat('epic-planning')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 rounded-lg transition-colors flex items-center space-x-2">
                                                <i class="fas fa-tasks text-purple-500"></i>
                                                <span>Epic Planning</span>
                                            </button>
                                            <button onclick="startNewChat('story-refinement')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 rounded-lg transition-colors flex items-center space-x-2">
                                                <i class="fas fa-list text-green-500"></i>
                                                <span>Story Refinement</span>
                                            </button>
                                            <button onclick="startNewChat('sprint-planning')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 rounded-lg transition-colors flex items-center space-x-2">
                                                <i class="fas fa-calendar-alt text-orange-500"></i>
                                                <span>Sprint Planning</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- File Upload Button -->
                                <div class="relative">
                                    <input type="file" id="file-upload" class="hidden" multiple accept=".pdf,.doc,.docx,.txt,.png,.jpg,.jpeg">
                                    <button type="button" onclick="document.getElementById('file-upload').click()" class="w-8 h-8 flex items-center justify-center text-gray-500 hover:text-ignis-primary hover:bg-white rounded-lg transition-all" title="Attach files">
                                        <i class="fas fa-paperclip text-xs"></i>
                                    </button>
                                </div>
                                
                                <!-- History/Recent Button -->
                                <div class="relative">
                                    <button type="button" id="history-button" onclick="toggleHistoryPopup()" class="w-8 h-8 flex items-center justify-center text-gray-500 hover:text-ignis-primary hover:bg-white rounded-lg transition-all" title="History">
                                        <i class="fas fa-clock-rotate-left text-xs"></i>
                                    </button>
                                    
                                    <!-- History Popup -->
                                    <div id="history-popup" class="hidden absolute bottom-full left-0 mb-2 w-80 bg-white border border-gray-200 rounded-xl shadow-xl z-50 max-h-96 overflow-hidden flex flex-col">
                                        <div class="px-4 py-3 border-b border-gray-200">
                                            <h3 class="text-xs font-semibold text-gray-900">Chat History</h3>
                                            <p class="text-xs text-gray-500 mt-0.5">Recent conversations</p>
                                        </div>
                                        <div class="overflow-y-auto flex-1">
                                            <div class="p-2">
                                                <!-- Today -->
                                                <div class="px-2 py-1 text-xs font-semibold text-gray-500">Today</div>
                                                <button onclick="loadChatHistory('chat1')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
                                                    <div class="flex items-start justify-between">
                                                        <div class="flex-1">
                                                            <p class="font-medium text-xs text-gray-900">Epic Generation</p>
                                                            <p class="text-xs text-gray-500 mt-0.5">Created 4 epics with 23 features...</p>
                                                        </div>
                                                        <span class="text-xs text-gray-400 ml-2">1h ago</span>
                                                    </div>
                                                </button>
                                                <button onclick="loadChatHistory('chat2')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
                                                    <div class="flex items-start justify-between">
                                                        <div class="flex-1">
                                                            <p class="font-medium text-xs text-gray-900">Story Refinement</p>
                                                            <p class="text-xs text-gray-500 mt-0.5">Refined acceptance criteria...</p>
                                                        </div>
                                                        <span class="text-xs text-gray-400 ml-2">3h ago</span>
                                                    </div>
                                                </button>
                                                
                                                <!-- Yesterday -->
                                                <div class="px-2 py-1 text-xs font-semibold text-gray-500 mt-2">Yesterday</div>
                                                <button onclick="loadChatHistory('chat3')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
                                                    <div class="flex items-start justify-between">
                                                        <div class="flex-1">
                                                            <p class="font-medium text-xs text-gray-900">Sprint Planning Session</p>
                                                            <p class="text-xs text-gray-500 mt-0.5">Planned Sprint 2 stories...</p>
                                                        </div>
                                                        <span class="text-xs text-gray-400 ml-2">1d ago</span>
                                                    </div>
                                                </button>
                                                <button onclick="loadChatHistory('chat4')" class="w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
                                                    <div class="flex items-start justify-between">
                                                        <div class="flex-1">
                                                            <p class="font-medium text-xs text-gray-900">Feature Breakdown</p>
                                                            <p class="text-xs text-gray-500 mt-0.5">Analyzed feature dependencies...</p>
                                                        </div>
                                                        <span class="text-xs text-gray-400 ml-2">1d ago</span>
                                                    </div>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="border-t border-gray-200 p-2">
                                            <button onclick="viewAllHistory()" class="w-full px-3 py-2 text-xs text-blue-600 hover:bg-blue-50 rounded-lg transition-colors font-medium">
                                                View All History
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Agent Selector Badge -->
                            <div class="relative">
                                <button type="button" id="agent-badge" onclick="toggleAgentDropdown()" class="flex items-center space-x-1.5 px-2.5 py-1.5 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-all text-xs font-medium">
                                    <span id="agent-name">PM</span>
                                    <i class="fas fa-chevron-down text-xs"></i>
                                </button>
                                
                                <!-- Agent Dropdown -->
                                <div id="agent-dropdown" class="hidden absolute bottom-full left-0 mb-2 w-56 bg-white border border-gray-200 rounded-xl shadow-xl z-50 py-2">
                                    <div class="px-3 py-2 text-xs font-semibold text-gray-500 border-b border-gray-100">Select Agent</div>
                                    <button onclick="selectAgent('Analyst', 'analyst')" class="w-full text-left px-4 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors">
                                        <span>Analyst</span>
                                    </button>
                                    <button onclick="selectAgent('Architect', 'architect')" class="w-full text-left px-4 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors">
                                        <span>Architect</span>
                                    </button>
                                    <button onclick="selectAgent('BMAD Master', 'bmad-master')" class="w-full text-left px-4 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors">
                                        <span>BMAD Master</span>
                                    </button>
                                    <button onclick="selectAgent('BMAD Orchestrator', 'bmad-orchestrator')" class="w-full text-left px-4 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors">
                                        <span>BMAD Orchestrator</span>
                                    </button>
                                    <button onclick="selectAgent('Dev', 'dev')" class="w-full text-left px-4 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors">
                                        <span>Dev</span>
                                    </button>
                                    <button onclick="selectAgent('PM', 'pm')" class="w-full text-left px-4 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors">
                                        <span>PM</span>
                                    </button>
                                    <button onclick="selectAgent('PO', 'po')" class="w-full text-left px-4 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors">
                                        <span>PO</span>
                                    </button>
                                    <button onclick="selectAgent('QA', 'qa')" class="w-full text-left px-4 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors">
                                        <span>QA</span>
                                    </button>
                                    <button onclick="selectAgent('SM', 'sm')" class="w-full text-left px-4 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors">
                                        <span>SM</span>
                                    </button>
                                    <button onclick="selectAgent('UX Expert', 'ux-expert')" class="w-full text-left px-4 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors">
                                        <span>UX Expert</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Text Input -->
                            <form id="chat-form" class="flex-1 flex items-center">
                                <input 
                                    id="chat-input"
                                    type="text" 
                                    placeholder="Type 'yes' to generate epics, features & stories..."
                                    class="flex-1 bg-transparent text-xs text-gray-900 placeholder-gray-400 outline-none border-none focus:ring-0 px-2"
                                />
                                
                                <!-- Send Button -->
                                <button type="submit" class="w-9 h-9 flex items-center justify-center bg-gradient-to-br from-ignis-primary to-ignis-accent text-white rounded-lg hover:shadow-lg transition-all flex-shrink-0">
                                    <i class="fas fa-arrow-up text-xs"></i>
                                </button>
                            </form>
                        </div>
                        
                        <!-- Selected Files Display -->
                        <div id="selected-files" class="mt-2 text-xs text-gray-500"></div>
                    </div>
                </div>

                <!-- Resizer -->
                <div id="resizer" class="hidden w-1 bg-gray-300 hover:bg-ignis-primary cursor-col-resize transition-colors flex-shrink-0" style="cursor: ew-resize;"></div>

                <!-- Document Viewer Panel (Right Side) -->
                <div id="document-panel" class="hidden border-l border-gray-200 bg-white flex flex-col overflow-hidden" style="flex: 0 0 50%; min-width: 300px; max-width: 80%;">
                    <!-- Panel Header -->
                    <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200 flex-shrink-0">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-tasks text-ignis-primary"></i>
                            <h3 id="doc-title" class="text-xs font-semibold text-gray-900">Epics, Features & Stories</h3>
                        </div>
                        <div class="flex items-center space-x-3">
                            <!-- View Selector -->
                            <select id="view-selector" class="text-xs border border-gray-300 rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ignis-primary">
                                <option value="all">All</option>
                                <option value="epics">Epics Only</option>
                                <option value="features">Features Only</option>
                                <option value="stories">Stories Only</option>
                            </select>
                            <button onclick="closeDocumentPanel()" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Panel Content -->
                    <div id="doc-content" class="flex-1 overflow-y-auto p-4">
                        <!-- Content will be dynamically loaded here -->
                    </div>
                    
                    <!-- Panel Footer Actions -->
                    <div class="flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50 flex-shrink-0">
                        <div class="flex space-x-2">
                            <button onclick="exportToJira()" class="px-3 py-1.5 text-xs bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-1.5">
                                <i class="fab fa-jira"></i>
                                <span>Export to Jira</span>
                            </button>
                            <button onclick="downloadDocument()" class="px-3 py-1.5 text-xs bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors flex items-center gap-1.5">
                                <i class="fas fa-download"></i>
                                <span>Download</span>
                            </button>
                        </div>
                        <button onclick="syncToSource()" class="px-3 py-1.5 text-xs bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1.5">
                            <i class="fas fa-sync-alt"></i>
                            <span>Sync to Source</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="shared-sidebar.js"></script>
    
    <script>
        // Toggle functions
        function toggleProjectDropdown() {
            const dropdown = document.getElementById('project-dropdown');
            const arrow = document.getElementById('dropdown-arrow');
            if (dropdown && arrow) {
                dropdown.classList.toggle('hidden');
                arrow.style.transform = dropdown.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
            }
        }

        function toggleUserDropdown() {
            const dropdown = document.getElementById('user-dropdown');
            const arrow = document.getElementById('user-dropdown-arrow');
            if (dropdown && arrow) {
                dropdown.classList.toggle('hidden');
                arrow.style.transform = dropdown.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
            }
        }

        function toggleAgentDropdown() {
            const dropdown = document.getElementById('agent-dropdown');
            dropdown.classList.toggle('hidden');
        }

        function toggleNewChatPopup() {
            const popup = document.getElementById('new-chat-popup');
            popup.classList.toggle('hidden');
        }

        function toggleHistoryPopup() {
            const popup = document.getElementById('history-popup');
            popup.classList.toggle('hidden');
        }

        function startNewChat(type) {
            console.log('Starting new chat:', type);
            // Clear current chat
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-ignis-primary to-ignis-accent rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-robot text-white text-xs"></i>
                    </div>
                    <div class="bg-white rounded-lg rounded-tl-none p-3 max-w-2xl shadow-sm">
                        <p class="text-gray-900 text-xs">Hi! I'm ready to help you with ${type === 'blank' ? 'your planning tasks' : type.replace('-', ' ')}. What would you like to discuss?</p>
                    </div>
                </div>
            `;
            toggleNewChatPopup();
            closeDocumentPanel();
        }

        function loadChatHistory(chatId) {
            console.log('Loading chat:', chatId);
            alert('Loading chat history: ' + chatId + '\n(This would load the previous conversation)');
            toggleHistoryPopup();
        }

        function viewAllHistory() {
            console.log('Viewing all history');
            alert('This would open a full history page with all past conversations');
            toggleHistoryPopup();
        }

        let currentAgent = 'PM';
        let currentAgentType = 'pm';

        function selectAgent(agentName, agentType) {
            currentAgent = agentName;
            currentAgentType = agentType;
            document.getElementById('agent-name').textContent = agentName;
            toggleAgentDropdown();
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            const agentDropdown = document.getElementById('agent-dropdown');
            const agentButton = document.getElementById('agent-badge');
            
            if (agentDropdown && agentButton && !agentDropdown.contains(event.target) && !agentButton.contains(event.target)) {
                agentDropdown.classList.add('hidden');
            }

            const newChatPopup = document.getElementById('new-chat-popup');
            const newChatButton = document.getElementById('new-chat-button');
            
            if (newChatPopup && newChatButton && !newChatPopup.contains(event.target) && !newChatButton.contains(event.target)) {
                newChatPopup.classList.add('hidden');
            }

            const historyPopup = document.getElementById('history-popup');
            const historyButton = document.getElementById('history-button');
            
            if (historyPopup && historyButton && !historyPopup.contains(event.target) && !historyButton.contains(event.target)) {
                historyPopup.classList.add('hidden');
            }
        });

        // Document Panel Functions
        function openDocumentPanel() {
            const panel = document.getElementById('document-panel');
            const resizer = document.getElementById('resizer');
            const docContent = document.getElementById('doc-content');
            
            // Load the epic, features, and stories content
            docContent.innerHTML = getEpicStoriesContent();
            
            // Show panel and resizer
            panel.classList.remove('hidden');
            resizer.classList.remove('hidden');
        }

        function closeDocumentPanel() {
            const panel = document.getElementById('document-panel');
            const resizer = document.getElementById('resizer');
            panel.classList.add('hidden');
            resizer.classList.add('hidden');
        }

        function getEpicStoriesContent() {
            return `
                <div class="text-xs text-gray-700 leading-relaxed space-y-6">
                    <!-- Epic 1 -->
                    <div class="epic-card bg-purple-50 rounded-lg p-4 border-l-4">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center space-x-2">
                                <span class="bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded">EPIC-1</span>
                                <h3 class="text-sm font-bold text-gray-900">User Authentication & Account Management</h3>
                            </div>
                            <span class="text-xs text-gray-500">Priority: High</span>
                        </div>
                        <p class="text-xs text-gray-700 mb-3">
                            As a user, I want to securely create and manage my account so that I can have a personalized shopping experience.
                        </p>
                        <div class="flex items-center space-x-4 text-xs text-gray-600 mb-4">
                            <span><i class="fas fa-clock mr-1"></i>Sprint 1-2</span>
                            <span><i class="fas fa-chart-line mr-1"></i>8 Features</span>
                            <span><i class="fas fa-list mr-1"></i>15 Stories</span>
                        </div>

                        <!-- Feature 1.1 -->
                        <div class="feature-card bg-blue-50 rounded-lg p-3 ml-4 mb-3 border-l-4">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="bg-blue-600 text-white text-xs font-semibold px-2 py-0.5 rounded">F-1.1</span>
                                    <h4 class="text-xs font-semibold text-gray-900">User Registration</h4>
                                </div>
                                <span class="text-xs text-gray-500">Story Points: 5</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-2">Enable users to create accounts with email, social login, and SSO.</p>
                            
                            <!-- Stories -->
                            <div class="space-y-2 ml-4">
                                <div class="story-card bg-green-50 rounded p-2 border-l-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="bg-green-600 text-white text-xs px-1.5 py-0.5 rounded">US-1.1.1</span>
                                            <p class="text-xs text-gray-800">As a user, I want to register with my email and password</p>
                                        </div>
                                        <span class="text-xs text-green-600 font-semibold">3 pts</span>
                                    </div>
                                    <div class="mt-2 ml-6 text-xs text-gray-600">
                                        <p class="font-semibold">Acceptance Criteria:</p>
                                        <ul class="list-disc list-inside ml-2 text-xs">
                                            <li>Email validation with format check</li>
                                            <li>Password strength requirements (8+ chars, uppercase, number, special char)</li>
                                            <li>Email verification link sent</li>
                                            <li>Account created only after email verification</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="story-card bg-green-50 rounded p-2 border-l-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="bg-green-600 text-white text-xs px-1.5 py-0.5 rounded">US-1.1.2</span>
                                            <p class="text-xs text-gray-800">As a user, I want to sign up using Google, Facebook, or Apple</p>
                                        </div>
                                        <span class="text-xs text-green-600 font-semibold">2 pts</span>
                                    </div>
                                    <div class="mt-2 ml-6 text-xs text-gray-600">
                                        <p class="font-semibold">Acceptance Criteria:</p>
                                        <ul class="list-disc list-inside ml-2 text-xs">
                                            <li>OAuth integration with Google, Facebook, Apple</li>
                                            <li>Auto-populate user info from social profiles</li>
                                            <li>Link social account to existing email if match found</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Feature 1.2 -->
                        <div class="feature-card bg-blue-50 rounded-lg p-3 ml-4 mb-3 border-l-4">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="bg-blue-600 text-white text-xs font-semibold px-2 py-0.5 rounded">F-1.2</span>
                                    <h4 class="text-xs font-semibold text-gray-900">User Login & Session Management</h4>
                                </div>
                                <span class="text-xs text-gray-500">Story Points: 5</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-2">Secure login with JWT and session persistence.</p>
                            
                            <div class="space-y-2 ml-4">
                                <div class="story-card bg-green-50 rounded p-2 border-l-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="bg-green-600 text-white text-xs px-1.5 py-0.5 rounded">US-1.2.1</span>
                                            <p class="text-xs text-gray-800">As a user, I want to login with email/password or social accounts</p>
                                        </div>
                                        <span class="text-xs text-green-600 font-semibold">3 pts</span>
                                    </div>
                                </div>

                                <div class="story-card bg-green-50 rounded p-2 border-l-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="bg-green-600 text-white text-xs px-1.5 py-0.5 rounded">US-1.2.2</span>
                                            <p class="text-xs text-gray-800">As a user, I want my session to persist across devices</p>
                                        </div>
                                        <span class="text-xs text-green-600 font-semibold">2 pts</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Epic 2 -->
                    <div class="epic-card bg-purple-50 rounded-lg p-4 border-l-4">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center space-x-2">
                                <span class="bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded">EPIC-2</span>
                                <h3 class="text-sm font-bold text-gray-900">Product Catalog & Search</h3>
                            </div>
                            <span class="text-xs text-gray-500">Priority: High</span>
                        </div>
                        <p class="text-xs text-gray-700 mb-3">
                            As a user, I want to easily browse and search for products so that I can find what I'm looking for quickly.
                        </p>
                        <div class="flex items-center space-x-4 text-xs text-gray-600 mb-4">
                            <span><i class="fas fa-clock mr-1"></i>Sprint 2-3</span>
                            <span><i class="fas fa-chart-line mr-1"></i>6 Features</span>
                            <span><i class="fas fa-list mr-1"></i>12 Stories</span>
                        </div>

                        <!-- Feature 2.1 -->
                        <div class="feature-card bg-blue-50 rounded-lg p-3 ml-4 mb-3 border-l-4">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="bg-blue-600 text-white text-xs font-semibold px-2 py-0.5 rounded">F-2.1</span>
                                    <h4 class="text-xs font-semibold text-gray-900">Advanced Product Search</h4>
                                </div>
                                <span class="text-xs text-gray-500">Story Points: 8</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-2">Implement text, voice, and visual search capabilities.</p>
                            
                            <div class="space-y-2 ml-4">
                                <div class="story-card bg-green-50 rounded p-2 border-l-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="bg-green-600 text-white text-xs px-1.5 py-0.5 rounded">US-2.1.1</span>
                                            <p class="text-xs text-gray-800">As a user, I want to search products by keywords with auto-suggestions</p>
                                        </div>
                                        <span class="text-xs text-green-600 font-semibold">5 pts</span>
                                    </div>
                                    <div class="mt-2 ml-6 text-xs text-gray-600">
                                        <p class="font-semibold">Acceptance Criteria:</p>
                                        <ul class="list-disc list-inside ml-2 text-xs">
                                            <li>Real-time search suggestions as user types</li>
                                            <li>Typo tolerance and spelling correction</li>
                                            <li>Search history saved for logged-in users</li>
                                            <li>Filter by price, rating, brand, category</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="story-card bg-green-50 rounded p-2 border-l-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="bg-green-600 text-white text-xs px-1.5 py-0.5 rounded">US-2.1.2</span>
                                            <p class="text-xs text-gray-800">As a user, I want to search using my voice</p>
                                        </div>
                                        <span class="text-xs text-green-600 font-semibold">3 pts</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Epic 3 -->
                    <div class="epic-card bg-purple-50 rounded-lg p-4 border-l-4">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center space-x-2">
                                <span class="bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded">EPIC-3</span>
                                <h3 class="text-sm font-bold text-gray-900">AI-Powered Recommendations</h3>
                            </div>
                            <span class="text-xs text-gray-500">Priority: Medium</span>
                        </div>
                        <p class="text-xs text-gray-700 mb-3">
                            As a user, I want personalized product recommendations so that I can discover items I might like.
                        </p>
                        <div class="flex items-center space-x-4 text-xs text-gray-600 mb-4">
                            <span><i class="fas fa-clock mr-1"></i>Sprint 3-4</span>
                            <span><i class="fas fa-chart-line mr-1"></i>4 Features</span>
                            <span><i class="fas fa-list mr-1"></i>8 Stories</span>
                        </div>

                        <!-- Feature 3.1 -->
                        <div class="feature-card bg-blue-50 rounded-lg p-3 ml-4 mb-3 border-l-4">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="bg-blue-600 text-white text-xs font-semibold px-2 py-0.5 rounded">F-3.1</span>
                                    <h4 class="text-xs font-semibold text-gray-900">Personalized Homepage</h4>
                                </div>
                                <span class="text-xs text-gray-500">Story Points: 8</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-2">ML-based personalization engine for homepage content.</p>
                            
                            <div class="space-y-2 ml-4">
                                <div class="story-card bg-green-50 rounded p-2 border-l-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="bg-green-600 text-white text-xs px-1.5 py-0.5 rounded">US-3.1.1</span>
                                            <p class="text-xs text-gray-800">As a user, I want to see product recommendations based on my browsing history</p>
                                        </div>
                                        <span class="text-xs text-green-600 font-semibold">5 pts</span>
                                    </div>
                                </div>

                                <div class="story-card bg-green-50 rounded p-2 border-l-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="bg-green-600 text-white text-xs px-1.5 py-0.5 rounded">US-3.1.2</span>
                                            <p class="text-xs text-gray-800">As a user, I want to see "Frequently Bought Together" suggestions</p>
                                        </div>
                                        <span class="text-xs text-green-600 font-semibold">3 pts</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Epic 4 -->
                    <div class="epic-card bg-purple-50 rounded-lg p-4 border-l-4">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center space-x-2">
                                <span class="bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded">EPIC-4</span>
                                <h3 class="text-sm font-bold text-gray-900">Shopping Cart & Checkout</h3>
                            </div>
                            <span class="text-xs text-gray-500">Priority: High</span>
                        </div>
                        <p class="text-xs text-gray-700 mb-3">
                            As a user, I want a seamless checkout experience so that I can complete my purchase quickly and easily.
                        </p>
                        <div class="flex items-center space-x-4 text-xs text-gray-600 mb-4">
                            <span><i class="fas fa-clock mr-1"></i>Sprint 4-5</span>
                            <span><i class="fas fa-chart-line mr-1"></i>5 Features</span>
                            <span><i class="fas fa-list mr-1"></i>10 Stories</span>
                        </div>

                        <!-- Feature 4.1 -->
                        <div class="feature-card bg-blue-50 rounded-lg p-3 ml-4 mb-3 border-l-4">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="bg-blue-600 text-white text-xs font-semibold px-2 py-0.5 rounded">F-4.1</span>
                                    <h4 class="text-xs font-semibold text-gray-900">One-Click Checkout</h4>
                                </div>
                                <span class="text-xs text-gray-500">Story Points: 8</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-2">Streamlined checkout with saved preferences.</p>
                            
                            <div class="space-y-2 ml-4">
                                <div class="story-card bg-green-50 rounded p-2 border-l-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="bg-green-600 text-white text-xs px-1.5 py-0.5 rounded">US-4.1.1</span>
                                            <p class="text-xs text-gray-800">As a user, I want to complete checkout with one click using saved information</p>
                                        </div>
                                        <span class="text-xs text-green-600 font-semibold">5 pts</span>
                                    </div>
                                    <div class="mt-2 ml-6 text-xs text-gray-600">
                                        <p class="font-semibold">Acceptance Criteria:</p>
                                        <ul class="list-disc list-inside ml-2 text-xs">
                                            <li>Use saved shipping address</li>
                                            <li>Use saved payment method</li>
                                            <li>Apply saved preferences (gift wrapping, delivery notes)</li>
                                            <li>Order confirmation in &lt;3 seconds</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Statistics -->
                    <div class="bg-blue-50 rounded-lg p-4 mt-6">
                        <h3 class="text-sm font-bold text-gray-900 mb-3">Project Summary</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-600">Total Epics</p>
                                <p class="text-2xl font-bold text-blue-600">4</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-600">Total Features</p>
                                <p class="text-2xl font-bold text-blue-600">23</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-600">Total User Stories</p>
                                <p class="text-2xl font-bold text-green-600">45</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-600">Total Story Points</p>
                                <p class="text-2xl font-bold text-purple-600">187</p>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-blue-200">
                            <p class="text-xs text-gray-600 mb-2">Estimated Timeline: 5 Sprints (10 weeks)</p>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function exportToJira() {
            alert('Exporting to Jira...\n\nThis will create:\n 4 Epics\n 23 Features\n 45 User Stories\n\nWith all acceptance criteria and story points.');
        }

        function downloadDocument() {
            alert('Downloading Epic, Features & Stories document as PDF...');
        }

        function syncToSource() {
            alert('Syncing to source control...\n\nUpdating project management tools and repositories.');
        }

        // View selector
        document.addEventListener('DOMContentLoaded', function() {
            const viewSelector = document.getElementById('view-selector');
            if (viewSelector) {
                viewSelector.addEventListener('change', function() {
                    // Filter content based on selected view
                    const value = this.value;
                    console.log('View changed to:', value);
                    // Add filtering logic here if needed
                });
            }
        });

        // Resizable Panel Logic
        let isResizing = false;
        const resizer = document.getElementById('resizer');
        const panel = document.getElementById('document-panel');
        const chatSection = document.getElementById('chat-section');
        const container = document.querySelector('.flex-1.flex.bg-white');

        if (resizer) {
            resizer.addEventListener('mousedown', function(e) {
                isResizing = true;
                document.body.style.cursor = 'ew-resize';
                document.body.style.userSelect = 'none';
            });
        }

        document.addEventListener('mousemove', function(e) {
            if (!isResizing || !container) return;

            const containerRect = container.getBoundingClientRect();
            const containerWidth = containerRect.width;
            const mouseX = e.clientX - containerRect.left;
            
            const panelWidth = containerWidth - mouseX;
            const panelWidthPercent = (panelWidth / containerWidth) * 100;
            
            if (panelWidthPercent >= 20 && panelWidthPercent <= 80) {
                panel.style.flex = `0 0 ${panelWidthPercent}%`;
            }
        });

        document.addEventListener('mouseup', function() {
            if (isResizing) {
                isResizing = false;
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
            }
        });
    </script>

    <script>
        // Chat functionality
        document.addEventListener('DOMContentLoaded', function() {
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            const chatMessages = document.getElementById('chat-messages');
            const fileUpload = document.getElementById('file-upload');
            const selectedFilesDiv = document.getElementById('selected-files');
            let uploadedFiles = [];

            // File upload handler
            if (fileUpload) {
                fileUpload.addEventListener('change', function(e) {
                    const files = Array.from(e.target.files);
                    uploadedFiles = files;
                    
                    if (files.length > 0) {
                        const fileNames = files.map(f => f.name).join(', ');
                        selectedFilesDiv.innerHTML = `
                            <span class="inline-flex items-center space-x-1">
                                <i class="fas fa-file text-ignis-primary"></i>
                                <span>${files.length} file(s) selected: ${fileNames}</span>
                                <button type="button" onclick="clearFiles()" class="ml-2 text-red-500 hover:text-red-700">
                                    <i class="fas fa-times text-xs"></i>
                                </button>
                            </span>
                        `;
                    } else {
                        selectedFilesDiv.innerHTML = '';
                    }
                });
            }

            // Clear files function
            window.clearFiles = function() {
                uploadedFiles = [];
                fileUpload.value = '';
                selectedFilesDiv.innerHTML = '';
            };

            // Phase toggle functionality
            const phaseToggles = document.querySelectorAll('.phase-toggle');
            phaseToggles.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const phaseSection = this.closest('.phase-section');
                    const submenu = phaseSection.querySelector('.phase-submenu');
                    const chevron = this.querySelector('.fa-chevron-down');
                    
                    if (submenu) {
                        submenu.classList.toggle('hidden');
                        if (chevron) {
                            chevron.style.transform = submenu.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
                        }
                    }
                });
            });

            // Mobile menu
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const sidebar = document.getElementById('sidebar');
            
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', function() {
                    sidebar.classList.toggle('-translate-x-full');
                    sidebar.classList.toggle('translate-x-0');
                });
            }

            if (chatForm) {
                chatForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const message = chatInput.value.trim().toLowerCase();
                    const originalMessage = chatInput.value.trim();
                    if (!message && uploadedFiles.length === 0) return;
                    
                    // Add user message with files and agent info
                    addUserMessage(originalMessage, uploadedFiles, currentAgent);
                    chatInput.value = '';
                    if (typeof clearFiles === 'function') clearFiles();
                    
                    // Check if user said "yes" or wants to create epics
                    if (message === 'yes' || message.includes('create') || message.includes('generate') || message.includes('start')) {
                        // Show typing indicator
                        setTimeout(() => {
                            addTypingIndicator();
                        }, 500);
                        
                        // Generate epics and show response
                        setTimeout(() => {
                            removeTypingIndicator();
                            addAIMessage(`Perfect! I'm generating the Epics, Features, and User Stories based on your PRD and Architecture. This will take a moment...`);
                            
                            // Open document panel after a short delay
                            setTimeout(() => {
                                openDocumentPanel();
                                addAIMessage(` Done! I've created 4 Epics with 23 Features and 45 User Stories. You can see them in the panel on the right. The breakdown includes:\n\n Epic 1: User Authentication (15 stories)\n Epic 2: Product Catalog & Search (12 stories)\n Epic 3: AI Recommendations (8 stories)\n Epic 4: Shopping Cart & Checkout (10 stories)\n\nWould you like me to export these to Jira or make any modifications?`);
                            }, 2000);
                        }, 2500);
                    } else {
                        // General response based on agent
                        setTimeout(() => {
                            const agentResponse = getAgentResponse(message, currentAgent);
                            addAIMessage(agentResponse);
                        }, 1000);
                    }
                });
            }

            function getAgentResponse(message, agent) {
                const responses = {
                    'PM': 'As a Product Manager, I can help you break down features into user stories, prioritize the backlog, and plan sprints. Just type "yes" or "create" to generate epics and stories!',
                    'PO': 'As a Product Owner, I can help refine user stories, define acceptance criteria, and manage the product backlog. Ready to create epics?',
                    'SM': 'As a Scrum Master, I can help with sprint planning, story point estimation, and team capacity planning. Shall we start?',
                    'Analyst': 'As an Analyst, I can help analyze requirements and break them into detailed user stories with clear acceptance criteria.',
                    'Architect': 'As an Architect, I can help ensure technical stories align with the system architecture.',
                    'Dev': 'As a Developer, I can help break down technical tasks and provide story point estimates.',
                    'QA': 'As a QA, I can help define test scenarios and acceptance criteria for user stories.',
                    'UX Expert': 'As a UX Expert, I can help create user-centric stories and design tasks.',
                    'BMAD Master': 'As BMAD Master, I can orchestrate the entire epic and story creation process.',
                    'BMAD Orchestrator': 'As BMAD Orchestrator, I can coordinate multiple agents to create comprehensive epics and stories.'
                };
                return responses[agent] || 'I can help you generate Epics, Features, and User Stories for your project. Just type "yes" or "create" to get started!';
            }

            function addUserMessage(message, files = [], agent = '') {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-start space-x-3 justify-end';
                
                let filesHtml = '';
                if (files.length > 0) {
                    filesHtml = `
                        <div class="mt-2 space-y-1">
                            ${files.map(file => `
                                <div class="flex items-center space-x-2 text-xs bg-white/20 rounded px-2 py-1">
                                    <i class="fas fa-file"></i>
                                    <span>${escapeHtml(file.name)}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                messageDiv.innerHTML = `
                    <div class="bg-ignis-primary text-white rounded-lg rounded-tr-none p-3 max-w-xs shadow-sm">
                        ${message ? `<p class="text-xs">${escapeHtml(message)}</p>` : ''}
                        ${filesHtml}
                        ${agent && agent !== 'PM' ? `<div class="mt-2 text-xs opacity-75"><i class="fas fa-user-tie mr-1"></i>Agent: ${escapeHtml(agent)}</div>` : ''}
                    </div>
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fa-regular fa-user text-gray-600 text-xs"></i>
                    </div>
                `;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function addAIMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-start space-x-3';
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-gradient-to-r from-ignis-primary to-ignis-accent rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-robot text-white text-xs"></i>
                    </div>
                    <div class="bg-white rounded-lg rounded-tl-none p-3 max-w-2xl shadow-sm">
                        <p class="text-gray-900 text-xs whitespace-pre-line">${escapeHtml(message)}</p>
                    </div>
                `;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function addTypingIndicator() {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-start space-x-3 typing-message';
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-gradient-to-r from-ignis-primary to-ignis-accent rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-robot text-white text-xs"></i>
                    </div>
                    <div class="bg-white rounded-lg rounded-tl-none p-3 shadow-sm">
                        <div class="typing-indicator text-gray-600">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                `;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function removeTypingIndicator() {
                const typingMessage = chatMessages.querySelector('.typing-message');
                if (typingMessage) {
                    typingMessage.remove();
                }
            }

            function escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, m => map[m]);
            }
        });
    </script>

</body>
</html>
